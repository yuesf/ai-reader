<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuesf.aireader.mapper.FileInfoMapper">

    <!-- 结果映射 -->
    <resultMap id="FileInfoResultMap" type="com.yuesf.aireader.entity.FileInfo">
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="file_name" property="fileName" jdbcType="VARCHAR"/>
        <result column="original_name" property="originalName" jdbcType="VARCHAR"/>
        <result column="file_size" property="fileSize" jdbcType="BIGINT"/>
        <result column="file_type" property="fileType" jdbcType="VARCHAR"/>
        <result column="folder" property="folder" jdbcType="VARCHAR"/>
        <result column="upload_time" property="uploadTime" jdbcType="TIMESTAMP"/>
        <result column="upload_user_id" property="uploadUserId" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="request_id" property="requestId" jdbcType="VARCHAR"/>
        <result column="page_nums" property="pageNums" jdbcType="INTEGER"/>
    </resultMap>

    <!-- 插入文件信息 -->
    <insert id="insert" parameterType="com.yuesf.aireader.entity.FileInfo">
        INSERT INTO file_info (
            id, file_name, original_name, file_size, 
            file_type, folder, upload_time, upload_user_id, status, request_id, page_nums
        ) VALUES (
            #{id}, #{fileName}, #{originalName}, #{fileSize}, 
            #{fileType}, #{folder}, #{uploadTime}, #{uploadUserId}, #{status}, #{requestId}, #{pageNums}
        )
    </insert>

    <update id="updateFileInfo" parameterType="com.yuesf.aireader.entity.FileInfo">
        UPDATE file_info set
                             page_nums = #{pageNums}
                         WHERE id = #{id}
    </update>

    <!-- 根据ID查询文件信息 -->
    <select id="selectById" resultMap="FileInfoResultMap">
        SELECT * FROM file_info WHERE id = #{id} AND status = 'ACTIVE'
    </select>

    <!-- 根据文件夹查询文件列表 -->
    <select id="selectByFolder" resultMap="FileInfoResultMap">
        SELECT * FROM file_info 
        WHERE folder = #{folder} AND status = 'ACTIVE'
        ORDER BY upload_time DESC
    </select>

    <!-- 根据上传用户ID查询文件列表 -->
    <select id="selectByUploadUserId" resultMap="FileInfoResultMap">
        SELECT * FROM file_info 
        WHERE upload_user_id = #{uploadUserId} AND status = 'ACTIVE'
        ORDER BY upload_time DESC
    </select>

    <!-- 更新文件状态 -->
    <update id="updateStatus">
        UPDATE file_info 
        SET status = #{status} 
        WHERE id = #{id}
    </update>

    <!-- 删除文件信息（软删除） -->
    <update id="deleteById">
        UPDATE file_info 
        SET status = 'DELETED' 
        WHERE id = #{id}
    </update>

</mapper>