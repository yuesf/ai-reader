<!--pages/pdfPreview/pdfPreview.wxml-->
<view class="container">
  <!-- 浮动控制按钮 -->
  <floating-controls 
    position="right-center"
    scale="{{pageScale}}"
    bind:zoomIn="onZoomIn"
    bind:zoomOut="onZoomOut"
    bind:reset="onReset">
  </floating-controls>

  <!-- 手势检测层 -->
  <view class="gesture-layer"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
        style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; pointer-events: {{pageScale > 1.0 ? 'none' : 'auto'}};">
  </view>

  <!-- 图片预览滚动容器：支持手势与定位到当前页 -->
  <scroll-view scroll-y="{{true}}" 
               scroll-x="{{pageScale > 1.0}}" 
               enhanced="{{true}}"
               show-scrollbar="{{false}}"
               enable-back-to-top="{{false}}"
               upper-threshold="50"
               lower-threshold="50"
               enable-flex="{{true}}"
               scroll-anchoring="{{true}}"
               style="height: calc(100vh - 140rpx); overflow: hidden; position: relative; z-index: 0;"
               bindscrolltolower="onScrollToLower"
               bindscroll="onScroll"
               scroll-into-view="{{scrollIntoViewId}}"
               scroll-with-animation="{{pageScale <= 1.0}}"
               scroll-left="{{scrollLeft}}"
               scroll-top="{{scrollTop}}">
    <view class="pages-wrapper" style="width: {{pageScale * 100}}%; height: {{pageScale * 100}}%; transform-origin: left top;">
      <block wx:for="{{pageImages}}" wx:key="page">
        <view id="page-{{item.page}}" class="page-item" style="width: 100%; margin: 16rpx auto; display:flex; flex-direction:column; align-items:center;">
          <image mode="widthFix"
                 class="page-image"
                 src="{{item.src}}"
                 data-page="{{item.page}}"
                 bindload="onImageLoad"
                 binderror="onImageError"
                 style="width: 100%; height: auto;"/>
          <view class="page-index">第 {{item.page}}{{totalPages ? (' / ' + totalPages) : ''}} 页</view>
          <view wx:if="{{item.error}}" class="page-error">加载失败</view>
        </view>
      </block>
    </view>

    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 底线提示 -->
    <view wx:if="{{showEndLine}}" class="end-line-container">
      <view class="end-line-text">—— 文件也是有底线的 ——</view>
    </view>
  </scroll-view>
</view>